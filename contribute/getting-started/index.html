<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css><title>Getting Started | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class=pf-c-nav__item><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class=pf-c-nav><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/contribute-to-docs/ class=pf-c-nav__link>Contributor's guide</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/creating-a-new-pattern/ class=pf-c-nav__link>Creating a new pattern</a><section class=pf-c-nav__subnav><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/structure/ class=pf-c-nav__link>Validated pattern structure</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/getting-started/ class="pf-c-nav__link pf-m-current">Getting Started</a></li></ul></section></li></ul></div></div></div><main class=pf-c-page__main><section class="pf-c-page__main-section pf-m-fill pf-m-light-100"><div class="pf-l-grid pf-m-gutter"><div class="pf-l-grid__item pf-m-8-col"><div class=pf-c-content><h1 id=getting-started-creating-a-new-pattern>Getting started creating a new pattern</h1><h1 id=prerequisites>Prerequisites</h1><p>Please make sure you have read the <a href=/creating-a-new-pattern>introduction section</a> and the <a href=/building-vps/structure>structure</a> section of this documentation.</p><h1 id=youre-probably-not-starting-from-scratch>You&rsquo;re probably not starting from scratch</h1><p>The validated patterns community has relied on existing architectures that have been successfully deployed in an enterprise. The architecture itself is a best practice in assembling technologies and projects to provide a working solution. How that solution is deployed and managed is a different matter. It may have evolved over time and may have grown in its deployment such that ongoing maintenance is not sustainable.</p><p>The validated patterns framework is much more of a best practice of structuring the various configuration assets and integrating with GitOps and DevOps tools.</p><p>Therefore the question really is: How do I move my successful architecture solution into a sustainable GitOps/DevOps framework? And that is what we are going to do in this section.</p><h1 id=moving-to-the-validated-patterns-framework>Moving to the validated patterns framework</h1><p>One of the first things that you should do is look at your current implementation of your workload and identify the Kubernetes manifests that are involved in order to run the workloads.</p><h2 id=when-and-how-to-use-values--files>When and how to use <code>values-</code> files</h2><p>There are 4 values files that make up any Validated Pattern. The values files are:</p><ul><li>values-<main-hub>.yaml (e.g. values-datacenter.yaml)</li><li>values-<edge>.yaml (e.g. values-edge-site.yaml or values-factory.yaml)</li><li>values-global.yaml</li><li>values-secrets.yaml</li></ul><h2 id=operators-into-framework>Operators into framework</h2><p>We begin our journey by identifying what application services are needed to run the workload. The Cloud Native Operator framework provides a way of managing the lifecycle of application services that are needed by the application workload. The validated pattern framework gives you a way to describe these Operators in a values file that is specific to your pattern and the site type.</p><p>So for example if we wish deploy Advanced Cluster Management, AMQ (messaging) and AMQ Streams (Kafka) in our datacenter, we would make the following subscription entries in our <code>values-datacenter.yaml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>namespaces</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>open-cluster-management</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>my-application</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>backend-storage</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>subscriptions</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>advanced-cluster-management</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>open-cluster-management</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>release-2.3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>csv</span>: <span style=color:#ae81ff>advanced-cluster-management.v2.3.2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>amq-streams</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>my-application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>amq-streams-1.7.x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>csv</span>: <span style=color:#ae81ff>amqstreams.v1.7.1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>amq-broker</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>my-application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>7.8</span><span style=color:#ae81ff>.x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>csv</span>: <span style=color:#ae81ff>amq-broker-operator.v7.8.1-opr-3</span>
</span></span></code></pre></div><p>This tells the framework which Operators are needed and what namespace they should be deployed in.</p><h2 id=grouping-applications-for-openshift-gitops>Grouping applications for OpenShift GitOps</h2><p>In the same values- file we need to inform OpenShift GitOps (ArgoCD) what applications to deploy and where the Helm Charts are so that they can be applied to the deployment and watched for future changes.</p><p>When using GitOps, specifically OpenShift GitOps (ArgoCD), it makes sense to break up applications into different areas of concern, i.e. projects. For example, the main applications for the datacenter might be grouped separately from some storage components:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>projects</span>:
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>storage</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>applications</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>acm</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>open-cluster-management</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>common/acm</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ignoreDifferences</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>internal.open-cluster-management.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ManagedClusterInfo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jsonPointers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/spec/loggingCA</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>central-kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>backend-storage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>storage</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>charts/datacenter/kafka</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ignoreDifferences</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>apps</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jsonPointers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/spec/replicas</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>route.openshift.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Route</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jsonPointers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/status</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>image.openshift.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ImageStream</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jsonPointers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/spec/tags</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>group</span>: <span style=color:#ae81ff>apps.openshift.io</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>DeploymentConfig</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>jsonPointers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/spec/template/spec/containers/0/image</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cool-app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>my-application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>project</span>: <span style=color:#ae81ff>datacenter</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>charts/datacenter/my-app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>plugin</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>helm-with-kustomize</span>
</span></span></code></pre></div><p>In the above example <code>acm</code> (ACM) is part of the main <code>datacenter</code> deployment, as is <code>cool-app</code>. However, <code>central-kafka</code> is part of <code>backend-storage</code>.</p><p>The <code>path:</code> tag tells OpenShift GitOps where to find the Helm charts needed to deploy this application (refer back to the <a href=https://hybrid-cloud-patterns.io/building-vps/structure/#the-charts-directory>charts directory description</a> for more details). OpenShift GitOps will continuously monitor for changes to artifacts in that location for updates to apply.</p><p>Each different site type would have its own values- file listing subscriptions and applications.</p><h2 id=scripts-to-framework>Scripts to framework</h2><h2 id=ansible-to-framework>Ansible to Framework</h2><h2 id=kustomize-to-framework>Kustomize to framework</h2><p>Kustomize can still be used within the framework but it will be driven by Helm. If you have a lot of <code>kustomization.yaml</code>, you may not need to refactor all of it. However, you will need a Helm chart to drive it and you will need to check for names and paths etc. that you may need to parameterize using the Helm templates capabilities.</p><p>For example, the original Argo CD subscription YAML from one of the patterns looked like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>operators.coreos.com/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Subscription</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>argocd-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>channel</span>: <span style=color:#ae81ff>alpha</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>installPlanApproval</span>: <span style=color:#ae81ff>Manual</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>argocd-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>: <span style=color:#ae81ff>community-operators</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sourceNamespace</span>: <span style=color:#ae81ff>openshift-marketplace</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>startingCSV</span>: <span style=color:#ae81ff>argocd-operator.v0.0.11</span>
</span></span></code></pre></div><p>While we could have continued to use the ArgoCD community operator, we instead transitioned to using OpenShift GitOps, the Red Hat supported product. But this static subscription would not allow updates for continuous integration of new versions. And you&rsquo;ll remember from the Operators section above that we specify channel names as part of the subscription of operators. So we can instead using something like this (understanding the move to openshift-gitops-operator instead of ArgoCD).</p><p>{% raw %}</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>operators.coreos.com/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Subscription</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-gitops-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>openshift-operators</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>operators.coreos.com/openshift-gitops-operator.openshift-operators</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>channel</span>: {{ <span style=color:#ae81ff>.Values.main.gitops.channel }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>installPlanApproval</span>: {{ <span style=color:#ae81ff>.Values.main.options.installPlanApproval }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>openshift-gitops-operator</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>: <span style=color:#ae81ff>redhat-operators</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sourceNamespace</span>: <span style=color:#ae81ff>openshift-marketplace</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>if .Values.main.options.useCSV }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>startingCSV</span>: <span style=color:#ae81ff>openshift-gitops-operator.{{ .Values.main.gitops.csv }}</span>
</span></span><span style=display:flex><span>{{- <span style=color:#ae81ff>end }}</span>
</span></span></code></pre></div><p>{% endraw %}</p><h1 id=lessons-learned>Lessons learned</h1><h2 id=size-matters>Size matters</h2><p>If things are taking a long time to deploy, use the OpenShift console to check on memory and other potential capacity issues with the cluster. If running in a cloud you may wish to up the machine size. Check the <a href=https://hybrid-cloud-patterns.io/infrastructure/>sizing charts</a>.</p></div></div><aside class="pf-l-grid__item pf-m-4-col pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#getting-started-creating-a-new-pattern>Getting started creating a new pattern</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisites>Prerequisites</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#youre-probably-not-starting-from-scratch>You&rsquo;re probably not starting from scratch</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#moving-to-the-validated-patterns-framework>Moving to the validated patterns framework</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#when-and-how-to-use-values--files>When and how to use <code>values-</code> files</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#operators-into-framework>Operators into framework</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#grouping-applications-for-openshift-gitops>Grouping applications for OpenShift GitOps</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#scripts-to-framework>Scripts to framework</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#ansible-to-framework>Ansible to Framework</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#kustomize-to-framework>Kustomize to framework</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#lessons-learned>Lessons learned</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#size-matters>Size matters</a></li></ul></li></ul></nav></aside></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div></footer></main></div></body></html>