<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css><link rel=stylesheet href=/css/custom.css><title>Ansible Automation Platform | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class=pf-c-nav><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/ class=pf-c-nav__link>Ansible Edge GitOps</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/getting-started/ class=pf-c-nav__link>Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/installation-details/ class=pf-c-nav__link>Installation Details</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/ansible-automation-platform/ class="pf-c-nav__link pf-m-current">Ansible Automation Platform</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/openshift-virtualization/ class=pf-c-nav__link>OpenShift Virtualization</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/ansible-edge-gitops/troubleshooting/ class=pf-c-nav__link>Troubleshooting</a></li></ul></div></div></div><main class=pf-c-page__main><section class=pf-c-page__main-section><div class="pf-l-grid pf-m-gutter"><div class="pf-l-grid__item pf-m-8-col"><div class=pf-c-content><div class=pf-c-content><h1 id=ansible-automation-platform>Ansible Automation Platform</h1><h1 id=how-its-installed>How it&rsquo;s installed</h1><p>See the installation details <a href=/ansible-edge-gitops/installation-details/#ansible-automation-platform-aap-formerly-known-as-ansible-tower>here</a>.</p><h1 id=how-to-log-in>How to Log In</h1><p>The default login user is <code>admin</code> and the password is generated randomly at install time; you will need the password to login in to the AAP interface. You do not have to log in to the interface - the pattern will configure the AAP instance; the pattern retrieves the password using the same technique as the <code>ansible_get_credentials.sh</code> script described below. If you want to inspect the AAP instance, or change any aspects of its configuration, there are two ways to login and look at it. Both mechanisms are equivalent; you get the same password to the same instance using either technique.</p><h2 id=via-the-openshift-console>Via the OpenShift Console</h2><p>In the OpenShift console, navigate to Workloads > Secrets and select the &ldquo;ansible-automation-platform&rdquo; project if you want to limit the number of Secrets you can see.</p><p><a href=/images/ansible-edge-gitops/ocp-console-secrets-aap-admin-password.png><img src=/images/ansible-edge-gitops/ocp-console-secrets-aap-admin-password.png alt=secrets-navigation></a></p><p>The Secret you are looking for is in the <code>ansible-automation-platform</code> project and is named <code>controller-admin-password</code>. If you click on it, you can see the Data.password field. It is shown revealed below to show that it is the same as what is shown by the script method of retrieving it below:</p><p><a href=/images/ansible-edge-gitops/ocp-console-aap-admin-password-detail.png><img src=/images/ansible-edge-gitops/ocp-console-aap-admin-password-detail.png alt=secrets-detail></a></p><h2 id=via-ansible_get_credentialsshhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainscriptsansible_get_credentialssh>Via <a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/scripts/ansible_get_credentials.sh>ansible_get_credentials.sh</a></h2><p>With your KUBECONFIG set, you can run <code>./scripts/ansible-get-credentials.sh</code> from your top-level pattern directory. This will use your OpenShift cluster admin credentials to retrieve the URL for your Ansible Automation Platform instance, as well as the password for its <code>admin</code> user, which is auto-generated by the AAP operator by default. The output of the command looks like this (your password will be different):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>./scripts/ansible_get_credentials.sh   
</span></span><span style=display:flex><span>[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match
</span></span><span style=display:flex><span>&#39;all&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY [Install manifest on AAP controller] ******************************************************************************
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Retrieve API hostname for AAP] ***********************************************************************************
</span></span><span style=display:flex><span>ok: [localhost]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Set ansible_host] ************************************************************************************************
</span></span><span style=display:flex><span>ok: [localhost]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Retrieve admin password for AAP] *********************************************************************************
</span></span><span style=display:flex><span>ok: [localhost]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Set admin_password fact] *****************************************************************************************
</span></span><span style=display:flex><span>ok: [localhost]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Report AAP Endpoint] *********************************************************************************************
</span></span><span style=display:flex><span>ok: [localhost] =&gt; {
</span></span><span style=display:flex><span>    &#34;msg&#34;: &#34;AAP Endpoint: https://controller-ansible-automation-platform.apps.mhjacks-aeg.blueprints.rhecoeng.com&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Report AAP User] *************************************************************************************************
</span></span><span style=display:flex><span>ok: [localhost] =&gt; {
</span></span><span style=display:flex><span>    &#34;msg&#34;: &#34;AAP Admin User: admin&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK [Report AAP Admin Password] ***************************************************************************************
</span></span><span style=display:flex><span>ok: [localhost] =&gt; {
</span></span><span style=display:flex><span>    &#34;msg&#34;: &#34;AAP Admin Password: CKollUjlir0EfrQuRrKuOJRLSQhi4a9E&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY RECAP *************************************************************************************************************
</span></span><span style=display:flex><span>localhost                  : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</span></span></code></pre></div><h1 id=pattern-aap-configuration-details>Pattern AAP Configuration Details</h1><p>In this section, we describe the details of the AAP configuration we apply as part of installing the pattern. All of the configuration discussed in this section is applied by the <a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/scripts/ansible_load_controller.sh>ansible_load_controller.sh</a> script.</p><h2 id=loading-a-manifest>Loading a Manifest</h2><p>After validating that AAP is ready to be configured, the first thing the script does is to install the manifest you specify in the <code>values-secret.yaml</code> file in the <code>files.manifest</code> setting. The value of this setting is expected to be a fully-pathed file that represents a Red Hat Satellite manifest file with a valid entitlement for AAP. The <em>only</em> thing this manifest is used for is entitling AAP.</p><p>Instructions for creating a suitable manifest file can be found <a href=https://www.redhat.com/en/blog/how-create-and-use-red-hat-satellite-manifest>here</a>.</p><p>While it is absolutely possible to entitle AAP via a username/password on first login, the automated mechanisms for entitling only support manifests, that is the technique the pattern uses.</p><h2 id=organizations>Organizations</h2><p>The pattern installs an Organization called <code>HMI Demo</code> is installed. This makes it a bit easier to separate what the pattern is doing versus the default configuration of AAP. The other resources created in AAP as part of the load process are associated with this Organization.</p><h2 id=credential-types-and-their-credentials>Credential Types (and their Credentials)</h2><h3 id=kubeconfig-kubeconfig>Kubeconfig (Kubeconfig)</h3><p>The Kubeconfig credential is for holding the OpenShift cluster admin kubeconfig file. This is used to query the <code>edge-gitops-vms</code> namespace for running VM instances. Since the kubeconfig is necessary for installing the pattern and must be available when the load script is running, the load script pulls it into an AAP secret and stores it for later use (and calls it <code>Kubeconfig</code>).</p><p>The template for creating the Credential Type was taken from <a href=https://blog.networktocode.com/post/kubernetes-collection-ansible/>here</a>.</p><h3 id=rhsmcredential-rhsm_credential>RHSMcredential (rhsm_credential)</h3><p>This credential is required to register the RHEL VMs and configure them for Kiosk mode. The registration process allows them to install packages from the Red Hat Content Delivery Network.</p><h3 id=machine-kiosk-private-key>Machine (kiosk-private-key)</h3><p>This is a standard AAP Machine type credential. <code>kiosk-private-key</code> is created with the username and private key from your <code>values-secret.yaml</code> file in the <code>kiosk-ssh.username</code> and <code>kiosk-ssh.privatekey</code> fields.</p><h3 id=kioskextraparams-kiosk_container_extra_params>KioskExtraParams (kiosk_container_extra_params)</h3><p>This CredentialType is considered &ldquo;secret&rdquo; because it includes the admin login password for the Ignition application. This passed to the provisioning playbook(s) as extra_vars.</p><h2 id=inventory>Inventory</h2><p>The pattern installs an Inventory (HMI Demo), but no inventory sources. This is due to the way that OpenShift Virtualization provides access to virtual machines. The IP address associated with the SSH service that a given VM is running is associated with the Service object on the VM. This is not the way the Kubernetes inventory plugin expects to work. So to make inventory dynamic, we are instead using a play to discover VMs and add them to inventory &ldquo;on the fly&rdquo;. What is unusual about DNS inside a Kubernetes cluster is that resources outside the namespace must use the cluster FQDN - which is <code>resource-name.resource-namespace.svc</code>.</p><p>It is also possible to define a static inventory - an example of how this would like is preserved in the pattern repository as <a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/inventory/hosts>hosts</a>.</p><p>A standard dynamic inventory script is available <a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/inventory/openshift_cluster.yml>here</a>. This will retrieve the object names, but it will not (currently) map the FQDN properly. Because of this limitation, we moved to using the inventory pre-play method.</p><h2 id=templates-key-playbooks-in-the-pattern>Templates (key playbooks in the pattern)</h2><h3 id=dynamic-provision-kiosk-playbookhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansibledynamic_kiosk_provisionyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/dynamic_kiosk_provision.yml>Dynamic Provision Kiosk Playbook</a></h3><p>This combines all three key workflows in this pattern:</p><ul><li>Dynamic inventory (inventory preplay)</li><li>Kiosk Mode</li><li>Podman Playbook</li></ul><p>It is safe to run multiple times on the same system. It is run on a schedule, every 10 minutes, to demonstrate this.</p><h3 id=kiosk-mode-playbookhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansiblekiosk_playbookyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/kiosk_playbook.yml>Kiosk Mode Playbook</a></h3><p>This playbook runs the <a href=/ansible-edge-gitops/ansible-automation-platform/#kiosk_mode>kiosk_mode role</a>.</p><h3 id=podman-playbookhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansiblepodman_playbookyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/podman_playbook.yml>Podman Playbook</a></h3><p>This playbook runs the <a href=/ansible-edge-gitops/ansible-automation-platform/#container_lifecycle>container_lifecycle role</a> with overrides suitable for the Ignition application container.</p><h3 id=ping-playbookhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansiblepingyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/ping.yml>Ping Playbook</a></h3><p>This playbook is for testing basic connectivity - making sure that you can reach the nodes you wish to manage, and that the credentials you have given will work on them. It will not change anything on the VMs - just gather facts from them (which requires elevating to root).</p><h2 id=schedules>Schedules</h2><h3 id=update-project-aeg-gitops>Update Project AEG GitOps</h3><p>This job runs every 5 minutes to update the GitOps repository associated with the project. This is necessary when any of the Ansible code (for example, the playbooks or roles associated with the pattern) changes, so that the new code is available to the AAP instance.</p><h3 id=dynamic-provision-kiosk-playbook>Dynamic Provision Kiosk Playbook</h3><p>This job runs every 10 minutes to provision and configure any kiosks it finds to run the Ignition application in a podman container, and configure firefox in kiosk mode to display that application. The playbook is designed to be idempotent, so it is safe to run multiple times on the same targets; it will not make user-visible changes to those targets unless it must.</p><p>This playbook combines the <a href=/ansible-edge-gitops/ansible-automation-platform/#inventory_preplayyml>inventory_preplay</a> and the <a href=/ansible-edge-gitops/ansible-automation-platform/#provision-kiosk-playbook>Provision Kiosk Playbook</a>.</p><h2 id=execution-environmenthttpsgithubcomhybrid-cloud-patternsansible-edge-gitopstreemainansibleexecution_environment><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/tree/main/ansible/execution_environment>Execution Environment</a></h2><p>The execution environment includes some additional collections beyond what is provided in the Default execution environment, including:</p><ul><li><a href=https://linux-system-roles.github.io/>fedora.linux_system_roles</a></li><li><a href=https://galaxy.ansible.com/containers/podman>containers.podman</a></li><li><a href=https://docs.ansible.com/ansible/latest/collections/community/okd/index.html>community.okd</a></li></ul><p>The execution environment definition is provided if you want to customize or change it; if so, you should also change the Execution Environment attributes of the Templates (in the <a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/scripts/ansible_load_controller.sh>load script</a>, those attributes are set by the variables <code>aap_execution_environment</code> and <code>aap_execution_environment_image</code>).</p><h2 id=roles-included-in-the-pattern>Roles included in the pattern</h2><h3 id=kiosk_modehttpsgithubcomhybrid-cloud-patternsansible-edge-gitopstreemainansibleroleskiosk_mode><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/tree/main/ansible/roles/kiosk_mode>kiosk_mode</a></h3><p>This role is responsible does the following:</p><ul><li>RHEL node registration</li><li>Installation of GUI packages</li><li>Installation of Firefox</li><li>Configuration of Firefox kiosk mode</li></ul><h3 id=container_lifecyclehttpsgithubcomhybrid-cloud-patternsansible-edge-gitopstreemainansiblerolescontainer_lifecycle><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/tree/main/ansible/roles/container_lifecycle>container_lifecycle</a></h3><p>This role is responsible for:</p><ul><li>Downloading and running a podman image on the system (and configure it to auto-update)</li><li>Setting the container up to run at boot time</li><li>Passing any other runtime arguments to the container. In this container&rsquo;s case, that includes specifying an admin password override.</li></ul><h2 id=extra-playbooks-in-the-pattern>Extra Playbooks in the Pattern</h2><h3 id=inventory_preplayymlhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansibleinventory_preplayyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/inventory_preplay.yml>inventory_preplay.yml</a></h3><p>This playbook is designed to be included in other plays; its purpose is to discover the desired inventory and add those hosts to inventory at runtime. It uses a kubernetes query via the cluster-admin kube config file.</p><h3 id=provision-kiosk-playbookhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainansibleprovision_kioskyml><a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/ansible/provision_kiosk.yml>Provision Kiosk Playbook</a></h3><p>This does the work of provisioning the kiosk, which configures kiosk mode, and also installs Ignition and configures it to start at boot. It runs the <a href=/ansible-edge-gitops/ansible-automation-platform/#kiosk_mode>kiosk_mode</a> and <a href=/ansible-edge-gitops/ansible-automation-platform/#container_lifecycle>container_lifecycle</a> roles.</p><h1 id=next-steps>Next Steps</h1><p><a href=https://groups.google.com/g/hybrid-cloud-patterns>Help & Feedback</a>{: .btn .fs-5 .mb-4 .mb-md-0 .mr-2 }
<a href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/issues>Report Bugs</a>{: .btn .btn-red .fs-5 .mb-4 .mb-md-0 .mr-2 }</p></div></div></div><div class="pf-l-grid__item pf-m-4-col"><nav class="pf-c-jump-links pf-m-vertical" aria-label=Contents><div class=pf-c-jump-links__main><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#ansible-automation-platform>Ansible Automation Platform</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#how-its-installed>How it&rsquo;s installed</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#how-to-log-in>How to Log In</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#via-the-openshift-console>Via the OpenShift Console</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#via-ansible_get_credentialsshhttpsgithubcomhybrid-cloud-patternsansible-edge-gitopsblobmainscriptsansible_get_credentialssh>Via <a class=pf-c-jump-links__link href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/blob/main/scripts/ansible_get_credentials.sh>ansible_get_credentials.sh</a></a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#pattern-aap-configuration-details>Pattern AAP Configuration Details</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#loading-a-manifest>Loading a Manifest</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#organizations>Organizations</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#credential-types-and-their-credentials>Credential Types (and their Credentials)</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#inventory>Inventory</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#templates-key-playbooks-in-the-pattern>Templates (key playbooks in the pattern)</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#schedules>Schedules</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#execution-environmenthttpsgithubcomhybrid-cloud-patternsansible-edge-gitopstreemainansibleexecution_environment><a class=pf-c-jump-links__link href=https://github.com/hybrid-cloud-patterns/ansible-edge-gitops/tree/main/ansible/execution_environment>Execution Environment</a></a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#roles-included-in-the-pattern>Roles included in the pattern</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#extra-playbooks-in-the-pattern>Extra Playbooks in the Pattern</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#next-steps>Next Steps</a></li></ul></nav></div></nav></div></div></section></main></div><div><div style=padding:10px;text-align:center;color:#d2d2d2;background-color:#000>Copyright &copy; 2022 Red Hat, Inc.</div></div></body></html>