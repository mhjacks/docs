<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css><title>Troubleshooting Guide | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class=pf-c-nav><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/medical-diagnosis/ class=pf-c-nav__link>Medical Diagnosis</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/medical-diagnosis/getting-started/ class=pf-c-nav__link>Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/medical-diagnosis/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/medical-diagnosis/troubleshooting/ class="pf-c-nav__link pf-m-current">Troubleshooting Guide</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/medical-diagnosis/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li></ul></div></div></div><main class=pf-c-page__main><section class=pf-c-page__main-section><div class="pf-l-grid pf-m-gutter"><div class="pf-l-grid__item pf-m-8-col"><div class=pf-c-content><div class=pf-c-content><h2 id=contents>Contents</h2><p>{: .no_toc}</p><h3 id=understanding-the-makefile>Understanding the Makefile</h3><p>The Makefile is the entrypoint for the pattern. We use the Makefile to bootstrap the pattern to the cluster. After the initial bootstrapping of the pattern, the Makefile isn&rsquo;t required for ongoing operations but can often be useful when needing to make a change to a config within the pattern by running a <code>make upgrade</code> which allows us to refresh the bootstrap resources without having to tear down the pattern or cluster.</p><h4 id=make-install--make-deploy>make install / make deploy</h4><p>Executing <code>make install</code> within the pattern application will trigger a <code>make deploy</code> from <code>&lt;pattern_directory>/common</code>. This initializes the <strong>common</strong> components of the pattern framework and will install a helm chart in the <code>default</code> namespace. At this point cluster services such as <strong>Red Hat Advanced Cluster Management</strong> and <strong>OpenShift Gitops</strong> are deployed.</p><p>Once <strong>common</strong> completes, the remaining tasks within the <code>make install</code> target will execute.</p><h4 id=make-vault-init--make-load-secrets>make vault-init / make load-secrets</h4><p>This pattern is integrated with <strong>HashiCorp Vault</strong> and <strong>External Secrets</strong> services for secrets management within the cluster. These targets install vault from a Helm chart and the load the secret <code>(values-secret.yaml)</code> you created during <a href=../getting-started#preparation>Getting Started</a>.</p><p>If <strong>values-secret.yaml</strong> does not exist, make will exit with an error saying so. Furthermore, if the <strong>values-secret.yaml</strong> file does exist but is improperly formatted, ansible will exit with an error about being improperly formatted. If you are not sure how format the secret, please refer to <a href=../getting-started#preparation>Getting Started</a>.</p><h4 id=make-bootstrap--make-upgrade>make bootstrap / make upgrade</h4><p><code>make bootstrap</code> is the target used for deploying the application specific components of the pattern. It is the final step in the initial <code>make install</code> target. Running <code>make bootstrap</code> directly should typically not be necessary, instead you are encouraged to run <code>make upgrade</code>.</p><p>Generally, executing <code>make upgrade</code> should only be required when something goes wrong with the application pattern deployment. For instance, if a value was missed, and the chart wasn&rsquo;t rendered correctly, executing <code>make upgrade</code> after fixing the value would be necessary.</p><p>If you have any further questions, please, feel free to review the <code>Makefile</code> for the <strong>common</strong> and <strong>Medical Diagnosis</strong> components. It is located in <code>common/Makefile</code> and <code>./Makefile</code> respectively.</p><h3 id=troubleshooting-the-pattern-deployment>Troubleshooting the Pattern Deployment</h3><p>Occasionally the pattern will encounter issues during the deployment. This can happen for any number of reasons, but most often it is because of either a change within the operator itself or something has changed/happened to the Operator Lifecycle Manager (OLM) which determines which operators are available in the operator catalog. Generally, when an issue occurs with the OLM, the operator is unavailable for installation. To ensure that the operator is in the catalog:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>oc get packagemanifests | grep &lt;operator-name&gt;
</span></span></code></pre></div><p>When an issue occurs with the operator itself you can verify the status of the <code>subscription</code> and make sure that there are no warnings.An additional option is to log into the OpenShift Console, click on Operators, and check the status of the operator.</p><p>Other issues encounter could be with a specific application within the pattern misbehaving. Most of the pattern is deployed into the <code>xraylab-1</code> namespace. Other components like ODF are deployed into <code>openshift-storage</code> and the OpenShift Serverless Operators are deployed into <code>knative-serving, knative-eventing</code> namespaces.</p><blockquote><p><strong>Use the grafana dashboard to assist with debugging and identifying the issue</strong></p></blockquote><hr><p><strong>Problem</strong>: No information is being processed in the dashboard</p><p><strong>Solution</strong>: Most often this is due to the image-generator deploymentConfig needing to be scaled up. The image-generator by design is <strong>scaled to 0</strong>;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc scale -n xraylab-1 dc/image-generator --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Or open the openshift-console, click on workloads, then click deploymentConfigs, click image-generator, and scale the pod to 1 or more.</p><hr><p><strong>Problem</strong>: When browsing to the <strong>xraylab</strong> grafana dashboard and there are no images in the right-pane, only a security warning.</p><p><strong>Solution</strong>: The certificates for the openshift cluster are untrusted by your system. The easiest way to solve this is to open a browser and go to the s3-rgw route (oc get route -n openshift-storage), then acknowledge and accept the security warning.</p><hr><p><strong>Problem</strong>: In the dashboard interface, no metrics data is available.</p><p><strong>Solution</strong>: There is likely something wrong with the Prometheus DataSource for the grafana dashboard. You can check the status of the datasource by executing the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>oc get grafanadatasources -n xraylab-1
</span></span></code></pre></div><p>Ensure that the prometheus datasource exists and that the status is available. This could potentially be the token from the service account (<strong>grafana-serviceaccount</strong>) that is provided to the datasource as a bearer token.</p><hr><p><strong>Problem</strong>: The dashboard is showing red in the corners of the dashboard panes.</p><p><a href=/images/medical-edge/medDiag-noDB.png><img src=/images/medical-edge/medDiag-noDB.png alt=database></a></p><p><strong>Solution</strong>: This is most likely due to the <strong>xraylab</strong> database not being available or misconfigured. Please check the database and ensure that it is functioning properly.</p><p><strong>Step 1</strong>: Ensure that the database is populated with the correct tables:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>oc exec -it xraylabdb-1-&lt;uuid&gt; bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql -u root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>USE xraylabdb;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SHOW tables;
</span></span></code></pre></div><p>The expected output is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>Welcome to the MariaDB monitor.  Commands end with ; or <span style=color:#ae81ff>\g</span>.
</span></span><span style=display:flex><span>Your MariaDB connection id is <span style=color:#ae81ff>75</span>
</span></span><span style=display:flex><span>Server version: 10.3.32-MariaDB MariaDB Server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Type <span style=color:#e6db74>&#39;help;&#39;</span> or <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#66d9ef>for</span> help. Type <span style=color:#e6db74>&#39;\c&#39;</span> to clear the current input statement.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MariaDB <span style=color:#f92672>[(</span>none<span style=color:#f92672>)]</span>&gt; USE xraylabdb;
</span></span><span style=display:flex><span>Database changed
</span></span><span style=display:flex><span>MariaDB <span style=color:#f92672>[</span>xraylabdb<span style=color:#f92672>]</span>&gt; show tables;
</span></span><span style=display:flex><span>+---------------------+
</span></span><span style=display:flex><span>| Tables_in_xraylabdb |
</span></span><span style=display:flex><span>+---------------------+
</span></span><span style=display:flex><span>| images_anonymized   |
</span></span><span style=display:flex><span>| images_processed    |
</span></span><span style=display:flex><span>| images_uploaded     |
</span></span><span style=display:flex><span>+---------------------+
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span> rows in set <span style=color:#f92672>(</span>0.000 sec<span style=color:#f92672>)</span>
</span></span></code></pre></div><p><strong>Step 2:</strong> Verify the password set in the <code>values-secret.yaml</code> is working</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oc exec -it xraylabdb-1-&lt;uuid&gt; bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mysql -u xraylab -D xraylabdb -h xraylabdb -p 
</span></span><span style=display:flex><span>&lt;provide your password at the prompt&gt;
</span></span></code></pre></div><p>If you are able to successfully login then your password has been configured correctly in vault,
the external secrets operator and mounted to the database correctly.</p><hr><p><strong>Problem</strong>: The image-generator is scaled correctly, but nothing is happening in the dashboard.</p><p><strong>Solution</strong>: This could be that the serverless eventing function isn&rsquo;t picking up the notifications from ODF and therefore, not triggering the knative-serving function to scale up. In this situation there are a number of things to check, the first thing is to check the logs of the <code>rook-ceph-rgw-ocs-storagecluster-cephobjectstore-a-&lt;podGUID></code> pod in the <code>openshift-storage</code> namespace.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>oc logs -n openshift-storage -f &lt;pod&gt; -c rgw
</span></span></code></pre></div><p><strong>You should see the <code>PUT</code> statement with a status code of <code>200</code></strong></p><p>Next ensure that the <code>kafkasource</code> and <code>kafkservice</code> and <code>kafka topic</code> resources have been created:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>
</span></span><span style=display:flex><span>oc get -n xraylab-1 kafkasource
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME          TOPICS            BOOTSTRAPSERVERS                                      READY   REASON   AGE
</span></span><span style=display:flex><span>xray-images   <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;xray-images&#34;</span><span style=color:#f92672>]</span>   <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;xray-cluster-kafka-bootstrap.xraylab-1.svc:9092&#34;</span><span style=color:#f92672>]</span>   True             23m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>oc get -n xraylab-1 kservice
</span></span><span style=display:flex><span>NAME              URL                                                  LATESTCREATED           LATESTREADY             READY   REASON
</span></span><span style=display:flex><span>risk-assessment   https://risk-assessment-xraylab-1.apps.&lt;SUBDOMAIN&gt;   risk-assessment-00001   risk-assessment-00001   True 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>oc get -n xraylab-1 kafkatopics
</span></span><span style=display:flex><span>NAME                                                                                               CLUSTER        PARTITIONS   REPLICATION FACTOR   READY
</span></span><span style=display:flex><span>consumer-offsets---84e7a678d08f4bd226872e5cdd4eb527fadc1c6a                                        xray-cluster   <span style=color:#ae81ff>50</span>           <span style=color:#ae81ff>1</span>                    True
</span></span><span style=display:flex><span>strimzi-store-topic---effb8e3e057afce1ecf67c3f5d8e4e3ff177fc55                                     xray-cluster   <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>3</span>                    True
</span></span><span style=display:flex><span>strimzi-topic-operator-kstreams-topic-store-changelog---b75e702040b99be8a9263134de3507fc0cc4017b   xray-cluster   <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>                    True
</span></span><span style=display:flex><span>xray-images                                                                                        xray-cluster   <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>1</span>                    True
</span></span></code></pre></div><hr></div></div></div><aside class="pf-l-grid__item pf-m-4-col pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#contents>Contents</a></li></ul></li></ul></nav></aside></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div></footer></main></div></body></html>