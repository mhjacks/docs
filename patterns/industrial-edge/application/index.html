<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css><title>Application Demos | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class=pf-c-nav><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/ class=pf-c-nav__link>Industrial Edge</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/getting-started/ class=pf-c-nav__link>Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/factory/ class=pf-c-nav__link>Factory Sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/application/ class="pf-c-nav__link pf-m-current">Application Demos</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/troubleshooting/ class=pf-c-nav__link>Troubleshooting</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/industrial-edge/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li></ul></div></div></div><main class=pf-c-page__main><section class=pf-c-page__main-section><div class="pf-l-grid pf-m-gutter"><div class="pf-l-grid__item pf-m-8-col"><div class=pf-c-content><div class=pf-c-content><h1 id=demonstrating-industrial-edge-example-applications>Demonstrating Industrial Edge example applications</h1><h2 id=background>Background</h2><p>Up until now the Industrial Edge 2.0 validated patterns has focused primarily on successfully deploying the architectural pattern. Now it is time to see GitOps and DevOps in action as we go through a number of demonstrations to change both configuration information and the applications that we are deploying.</p><p>If you have already deployed the data center and optionally a factory (edge) cluster, then you have already seen several applications deployed in the OpenShift GitOps console. If you haven&rsquo;t done this then we recommend you deploy the data center after you have setup the Quay repositories described below.</p><h2 id=prerequisite-preparation>Prerequisite preparation</h2><h3 id=quay-public-registry-setup>Quay public registry setup</h3><p>In the <a href=https://quay.io>Quay.io</a> registry please ensure you have the following repositories and that they are set for public access. Replace your-org with the name of your organization or Quay.io username.</p><ul><li><em>your-org</em>/iot-software-sensor</li><li><em>your-org</em>/iot-consumer</li><li><em>your-org</em>/iot-frontend</li><li><em>your-org</em>/iot-anomaly-detection</li><li><em>your-org</em>/http-ionic</li></ul><p>These repositories are needed in order to provide container images built at the data center to be consumed by the factories (edge).</p><h3 id=local-laptopworkstation>Local laptop/workstation</h3><p>Make sure you have <code>git</code> and OpenShift&rsquo;s <code>oc</code> command-line clients.</p><h3 id=openshift-cluster>OpenShift Cluster</h3><p>Make sure you have the <code>kubeadmin</code> administrator login for the data center cluster. Use this or the <code>kubeconfig</code> (export the path) to provide administrator access to your data center cluster. It is not required that you have access to the edge (factory) clusters. GitOps and DevOps will take care of the edge clusters.</p><h3 id=github-account>GitHub account</h3><p>You will need to login into GitHub and be able to fork two repositories.</p><ul><li>hybrid-cloud-patterns/industrial-edge</li><li>hybrid-cloud-patterns/manuela-dev</li></ul><h2 id=configuration-changes-with-gitops>Configuration changes with GitOps</h2><p>There will may be times where you need to change the configuration of some of the edge devices in one or more of your factories. In our example, we have various sensors at the factory. Modification can be made to these sensors using <code>ConfigMaps</code>.</p><p><a href=/images/industrial-edge/highleveldemodiagram.png><img src=/images/industrial-edge/highleveldemodiagram.png alt=highleveldemodiagram></a></p><p>In this demonstration we will turn on a temperature sensor for sensor #2. We will first do this in the data center because this will demonstrate the power of GitOps without having to involve the edge/factory. However if you do have an factory joined using Advanced Cluster Management, then the changes will make their way out to the factory. But it is not necessary for the demo as we have a complete test environment on the data center.</p><p>Make sure you are able to see the dashboard application in a tab on your browser. You can find the URL for the dashboard application by looking at the following in your OpenShift console.</p><p><a href=/images/industrial-edge/network-routing-line-dashboard.png><img src=/images/industrial-edge/network-routing-line-dashboard.png alt=network-routing-line-dashboard></a></p><p>Select Networking->Routes on the left-hand side of the console. Using the Projects pull-down, select <code>manuela-tst-all</code>. Click on the URL under the Location column for the route Name <code>line-dashboard</code>. this will launch the line-dashboard monitoring application in a browser tab. The URL will look like:</p><p><code>line-dashboard-manuela-tst-all.apps.*cluster-name*.*domain*</code></p><p>Once the the application is open in your browser, click on the “Realtime Data” Navigation on the left and wait a bit. Data should be visualized as received. Note that there is only vibration data shown! If you wait a bit more (usually every 2-3 minutes), you will see an anomaly and alert on it.</p><p><a href=/images/industrial-edge/app-line-dashboard-before.png><img src=/images/industrial-edge/app-line-dashboard-before.png alt=app-line-dashboard-before></a></p><p>Now let&rsquo;s turn on the temperature sensor. Using you favorite editor, edit the following file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>industrial-edge/charts/data-center/manuela-test/templates/machine-sensor/machine-sensor-2-configmap.yaml
</span></span></code></pre></div><p>Change <code>SENSOR_TEMPERATURE_ENABLED: "false"</code> to <code>SENSOR_TEMPERATURE_ENABLED: "true"</code>.</p><p>Then change and commit this to your git repository so that the change will be picked up by OpenShift GitOps (ArgoCD).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git add industrial-edge-charts/data/center/manuela-test/templates/machine-sensor/machine-sensor-2-configmap.yaml
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;Turned on temprature sensor for machine sensor #2&#34;</span>
</span></span><span style=display:flex><span>git push
</span></span></code></pre></div><p>You can track the progress of this commit/push in your OpenShift GitOps console in the <code>manuela-test-all</code> application. You will notice components regarding machine-sensor-2 getting sync-ed. You can speed this up by manually pressing the Refresh button.</p><p><a href=/images/industrial-edge/argocd-line-dashboard.png><img src=/images/industrial-edge/argocd-line-dashboard.png alt=argocd-line-dashboard></a></p><p>The dashboard app should pickup the change automatically, once data from the temperature sensor is received.
Sometimes a page/tab refreshed is needed for the change to be picked up.</p><p><a href=/images/industrial-edge/app-line-dashboard.png><img src=/images/industrial-edge/app-line-dashboard.png alt=app-line-dashboard></a></p><h2 id=application-changes-using-devops>Application changes using DevOps</h2><p>The <code>line-dashboard</code> application has temperature sensors. In this demonstration we are going to make a simple change to that application, rebuild and redeploy it. In the <code>manuela-dev</code> repository there is a file <code>components/iot-consumer/index.js</code>. This JavaScript program consumes message data coming from the line servers and one of functions it performs is to check the temperature to see if it has exceeded a threshold. There is three lines of code in there that does some Celsius to Fahrenheit conversion.</p><p>Depending on the state of your <code>manuela-dev</code> repository this may or may not be commented out. Ideally for the demonstration you would want it uncommented and therefore effective. What this means is that while the labels on the frontend application are showing Celsius, the data is actually in Fahrenheit. This is a good place to start because that data won&rsquo;t make any sense.</p><p><a href=/images/industrial-edge/fahrenheit-temp.png><img src=/images/industrial-edge/fahrenheit-temp.png alt=fahrenheit-temp></a></p><p>Machines running over 120C is not normal. However examining the code explains why. There is an erroneous conversion taking place. What must happen is we remove or comment out this code.</p><p><a href=/images/industrial-edge/uncommented-code.png><img src=/images/industrial-edge/uncommented-code.png alt=uncommented-code></a></p><p>If you haven&rsquo;t deployed the uncommented code it might be best to prepare that before the demonstration. After pointing out the problem, comment out the code.</p><p><a href=/images/industrial-edge/commented-code.png><img src=/images/industrial-edge/commented-code.png alt=commented-code></a></p><p>Now that the erroneous conversion code has been commented out it is is time rebuild and redeploy. First commit and push the code to the repository. While in the directory for your <code>manuela-dev</code> repository run the following commands. The <code>components/iot-consumer/index.js</code> file should be the only changed file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git add components/iot-consumer/index.js
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;commented out C to F temp conversion&#34;</span>
</span></span><span style=display:flex><span>git push
</span></span></code></pre></div><p>Now its time to kick off the CI pipeline. Due to the need for GitHub secrets and Quay secrets as part of this process, we currently can&rsquo;t use the OpenShift console&rsquo;s Pipelines to kick off the pipeline in the demo environment. Instead, use the command-line. While in the <code>industrial-edge</code> repository directory, run the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>make build-and-test
</span></span></code></pre></div><p>This build takes some time because the pipeline is rebuilding all the images. You can monitor the pipeline&rsquo;s progress in the Openshift console&rsquo;s pipelines section.</p><p>Alternatively you can can try and run the shorter <code>build-iot-consumer</code> pipeline run in the OpenShift console. This should just run and test the specific application.</p><p><a href=/images/industrial-edge/build-and-test-pipeline.png><img src=/images/industrial-edge/build-and-test-pipeline.png alt=build-and-test-pipeline></a></p><p>You can also see some updates happening in the <code>manuela-tst</code> application in OpenShift GitOps (ArgoCD).</p><p>When the pipeline is complete check the <code>lines-dashboard</code> application again in the browser. More reasonable, Celsius, temperatures are displayed. (Compare with above.)</p><p><a href=/images/industrial-edge/celsius-temp.png><img src=/images/industrial-edge/celsius-temp.png alt=celsius-temp></a></p><p>The steps above have successfully applied the change to the Manuela test environment at the data center. In order for these changes to be pushed out to the factories it must be accepted and pushed to the Git repository. Examine the project in GitHub. There is a new Pull Request (PR) called <strong>Pull request created by Tekton task github-add-pull-request</strong>. Select that PR and merge the pull request.</p><p><a href=/images/industrial-edge/tekton-pull-request.png><img src=/images/industrial-edge/tekton-pull-request.png alt=tekton-pull-request></a></p><p>OpenShift GitOps will see the new change and apply it out to the factories.</p><h2 id=application-ai-model-changes-with-devops>Application AI model changes with DevOps</h2><p>After a successful deployment of Industrial Edge 2.0, check to see that Jupyter Hub is running. To do this go to project <code>manuela-ml-workspace</code> check that <code>jupyterhub</code> pods are up and running.</p><p><a href=/images/industrial-edge/jupyterhub-pods.png><img src=/images/industrial-edge/jupyterhub-pods.png alt=jupyerhub-pods></a></p><p>Then, in the same project <code>manuela-ml-namespace</code>, select Networking/Routes and click on the URL associated with <code>jupyterhub</code> in the Location column.</p><p><a href=/images/industrial-edge/jupyterhub-url.png><img src=/images/industrial-edge/jupyterhub-url.png alt=jupyterhub-url></a></p><p>This will bring you to a web page at an address in the following format:</p><ul><li><code>jupyterhub-manuela-ml-workspace.apps.*clustername*.*your-domain*</code></li></ul><p>Options for different types of Jupyter servers are shown. There are two options that are useful for this demo.</p><ul><li>Standard Data Science. Select this notebook image for simpler notebooks like <code>Data Analyses.ipynb</code></li><li>Tensorflow Notebook Image. Select this notebook image for more a complex notebook that require Tensorflow. E.g. <code>Anomaly Detection-using-TF-and-Deep-Learning.ipynb</code></li></ul><p>At the bottom of the screen there is a <code>Start server</code> button. Select the type of Notebook server image and press <code>Start server</code>.</p><p><a href=/images/industrial-edge/jupyterhub-init-console.png><img src=/images/industrial-edge/jupyterhub-init-console.png alt=jupyterhub-init-console></a></p><p>Selecting Tensorflow notebook image:</p><p><a href=/images/industrial-edge/jupyter-tf-server.png><img src=/images/industrial-edge/jupyter-tf-server.png alt=jupyter-tf-server></a></p><p>On the next screen upload the following files from <code>manuela-dev/ml-models/anomaly-detection</code>:</p><ul><li>One of the Jupyter notebooks<ul><li><code>Data-Analyses.ipynb</code> for a somewhat simpler demo</li><li><code>Anomaly Detection-using-TF-and-Deep-Learning.ipynb</code> for a Tensorflow demo.</li></ul></li><li>raw-data.cvs</li></ul><p><a href=/images/industrial-edge/upload-ml-files.png><img src=/images/industrial-edge/upload-ml-files.png alt=upload-ml-files></a></p><p>Open the notebook by double clicking on the notebook file (ending in <code>.ipynb</code>)</p><p><a href=/images/industrial-edge/anomaly-detection-notebook.png><img src=/images/industrial-edge/anomaly-detection-notebook.png alt=anomaly-detection-notebook></a></p><p>After opening the notebook successfully, walk through the demonstration by pressing play and iterating through the commands in the playbook. Jupyter playbooks are interactive and you may make changes and also save those changes. Also, some steps in the notebook take milliseconds, however, other steps can take a long time (up to an hour), so check on the completion of steps.</p><p>Remember that changes to the notebook will require downloading, committing, and pushing that notebook to the git repository so that it gets redeployed to the factories.</p><h2 id=turning-on-event-streaming-between-the-edge-and-the-datacenter>Turning on event streaming between the edge and the datacenter</h2><p>There is one other area that has not been completed for the overall validated pattern. The unfinished part is the streaming of events from the factory back to the datacenter and adding that data to the data lake for data scientists to apply their &ldquo;magic&rdquo;.</p><p>The automation for this is complete. However, there are certificates and/or keys that need to be replaced in the following files for the datacenter and factory templates:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>industrial-edge/charts/datacenter/kafka/templates/kafka-tls-certificate-and-key.yaml
</span></span><span style=display:flex><span>industrial-edge/charts/factory/templates/factory-kafka-cluster/kafka-tls-certificate-and-key.yaml
</span></span><span style=display:flex><span>industrial-edge/charts/factory/templates/factory-mirror-maker/kafka-tls-certificate.yaml
</span></span></code></pre></div><p>See the Yaml files for more details.</p><p>After updating these files with the proper certs/keys, apply the changes to the OpenShift cluster using <code>oc apply</code>.</p></div></div></div><aside class="pf-l-grid__item pf-m-4-col pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#demonstrating-industrial-edge-example-applications>Demonstrating Industrial Edge example applications</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#background>Background</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#prerequisite-preparation>Prerequisite preparation</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#configuration-changes-with-gitops>Configuration changes with GitOps</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#application-changes-using-devops>Application changes using DevOps</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#application-ai-model-changes-with-devops>Application AI model changes with DevOps</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#turning-on-event-streaming-between-the-edge-and-the-datacenter>Turning on event streaming between the edge and the datacenter</a></li></ul></li></ul></nav></aside></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div></footer></main></div></body></html>