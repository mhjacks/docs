<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css><title>Secured Development Cluster | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class=pf-c-nav><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/ class=pf-c-nav__link>Multicluster DevSecOps</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/getting-started/ class=pf-c-nav__link>Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/devel-cluster/ class="pf-c-nav__link pf-m-current">Secured Development Cluster</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/production-cluster/ class=pf-c-nav__link>Secured Production Clusters</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/secure-supply-chain-demo/ class=pf-c-nav__link>Multicluster DevSecOps Demo</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/devsecops/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li></ul></div></div></div><main class=pf-c-page__main><section class=pf-c-page__main-section><div class="pf-l-grid pf-m-gutter"><div class="pf-l-grid__item pf-m-8-col"><div class=pf-c-content><div class=pf-c-content><h1 id=having-a-development-cluster-devel-join-the-hub>Having a development cluster (devel) join the hub</h1><h2 id=introduction>Introduction</h2><p>Development clusters are responsible for building applications and delivering the applications to a secured registry. The development cluster defines a secure pipeline that includes code and image scans and image signing before delivering them to the registry. OpenShift Pipelines is used for the continuous integration (CI). The Quay registry is deployed on the hub and therefore integration is required for the development pipeline to push images to the registry.</p><p>Development clusters also need to be secured and so one part of the deployment is Advanced Cluster Security with a secured configuration. This allows ACS to monitor and report on security issues on the cluster. ACS secured sites report to an ACS Central application that is deployed on the hub.</p><h2 id=allow-acm-to-deploy-the-devel-applications-to-a-subset-of-clusters>Allow ACM to deploy the devel applications to a subset of clusters</h2><p>By default the <code>devel</code> applications are deployed on any development clusters that ACM knows about.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>managedClusterGroups:</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>name:</span> <span style=color:#960050;background-color:#1e0010>devel</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>helmOverrides:</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>name:</span> <span style=color:#960050;background-color:#1e0010>clusterGroup.isHubCluster</span>
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>value:</span> <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>clusterSelector:</span>
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>matchLabels:</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>clusterGroup:</span> <span style=color:#960050;background-color:#1e0010>devel</span>
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>matchExpressions:</span>
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>key:</span> <span style=color:#960050;background-color:#1e0010>vendor</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>operator:</span> <span style=color:#960050;background-color:#1e0010>In</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>values:</span>
</span></span><span style=display:flex><span>          <span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>OpenShift</span>
</span></span></code></pre></div><p>Remember to commit the changes and push to GitHub so that GitOps can see
your changes and apply them.</p><h2 id=deploy-a-devel-cluster>Deploy a devel cluster</h2><p>Rather than provide instructions on creating a devel cluster it is assumed
that an OpenShift cluster has already been created. Use the <code>openshift-install</code> program provided at <a href=https://console.redhat.com/openshift/create title="Create an OpenShift cluster">cloud.redhat.com</a></p><p>There are a three ways to join the devel cluster to the hub.</p><ul><li>Using the ACM user interface</li><li>Using the <code>cm</code> tool</li><li>Using the <code>clusteradm</code> tool</li></ul><h2 id=devel-setup-using-the-acm-ui>Devel setup using the ACM UI</h2><p>After ACM is installed a message regarding a &ldquo;Web console update is available&rdquo; may be displayed.
Click on the &ldquo;Refresh web console&rdquo; link.</p><p><img src=/images/web-console-update-message.png alt=update-web-console title="Update web console"></p><p>On the upper-left side you&rsquo;ll see a pull down labeled &ldquo;local-cluster&rdquo;. Select &ldquo;All Clusters&rdquo; from this pull down.
This will navigate to the ACM console and to its &ldquo;Clusters&rdquo; section</p><p><img src=/images/local-all-cluster-pulldown.png alt=launch-acm-console title="Launch ACM console"></p><p>Select the &ldquo;Import cluster&rdquo; option beside the highlighted Create Cluster button.</p><p><img src=/images/import-cluster.png alt=import-cluster title="Select Import cluster"></p><p>On the &ldquo;Import an existing cluster&rdquo; page, enter the cluster name and choose Kubeconfig as the &ldquo;import mode&rdquo;. Add the tag <code>clusterGroup=devel</code> Press import. Done.</p><p><img src=/images/devsecops/import-devel-cluster.png alt=import-with-kubeconfig title="Import using kubeconfig"></p><p>Using this method, you are done. Skip to the section <a href=#devel-is-joined>Devel is joined</a> but ignore the part about adding the site tag.</p><h2 id=devel-setup-using-cm-tool>Devel setup using <code>cm</code> tool</h2><ol><li><p>Install the <code>cm</code> (cluster management) command-line tool. See details <a href=https://github.com/open-cluster-management/cm-cli/#installation>here</a></p></li><li><p>Obtain the KUBECONFIG file from the devel cluster.</p></li><li><p>On the command-line login into the hub/datacenter cluster (use <code>oc login</code> or export the KUBECONFIG).</p></li><li><p>Run the following command:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cm attach cluster --cluster &lt;cluster-name&gt; --cluster-kubeconfig &lt;path-to-KUBECONFIG&gt;
</span></span></code></pre></div><p>Skip to the section <a href=#devel-is-joined>Devel is joined</a></p><h2 id=devel-setup-using-clusteradm-tool>Devel setup using <code>clusteradm</code> tool</h2><p>You can also use <code>clusteradm</code> to join a cluster. The following instructions explain what needs to be done. <code>clusteradm</code> is still in testing.</p><ol><li><p>To deploy a edge cluster you will need to get the datacenter (or hub) cluster&rsquo;s token. You will need to install <code>clusteradm</code>. On the existing <em>datacenter cluster</em>:</p><p><code>clusteradm get token</code></p></li><li><p>When you run the <code>clusteradm</code> command above it replies with the token and also shows you the command to use on the devel. So first you must login to the devel cluster</p><p><code>oc login</code>
or</p><p><code>export KUBECONFIG=~/my-ocp-env/devel</code></p></li><li><p>Then request to that the devel join the datacenter hub</p><p><code>clusteradm join --hub-token &lt;token from clusteradm get token command > &lt;devel cluster name></code></p></li><li><p>Back on the hub cluster accept the join request</p><p><code>clusteradm accept --clusters &lt;devel-cluster-name></code></p></li></ol><p>Skip to the next section, <a href=#devel-is-joined>Devel is joined</a></p><h2 id=devel-is-joined>Devel is joined</h2><h3 id=designate-the-new-cluster-as-a-devel-site>Designate the new cluster as a devel site</h3><p>Now that ACM is no longer deploying the devel applications everywhere, we need
to explicitly indicate that the new cluster has the devel role. If you haven&rsquo;t tagged the cluster as <code>clusterGroup=devel</code> then we can do that here.</p><p>We do this by adding the label referenced in the managedSite&rsquo;s <code>clusterSelector</code>.</p><ol><li><p>Find the new cluster</p><p><code>oc get managedclusters.cluster.open-cluster-management.io</code></p></li><li><p>Apply the label</p><p><code>oc label managedclusters.cluster.open-cluster-management.io/YOURCLUSTER clusterGroup=devel</code></p></li></ol><h3 id=youre-done>You&rsquo;re done</h3><p>That&rsquo;s it! Go to your devel (edge) OpenShift console and check for the open-cluster-management-agent pod being launched. Be patient, it will take a while for the ACM agent and agent-addons to launch. After that, the operator OpenShift GitOps will run. When it&rsquo;s finished check that all applications have synced in OpenShift GitOps. Select &ldquo;Devel Argo CD&rdquo; from the OpenShift Applications menu.</p><p><a href=/images/devsecops/ocp-devel-argocd-menu.png><img src=/images/devsecops/ocp-devel-argocd-menu.png alt="GitOps Devel app"></a></p><p>Then look at the GitOps applications and make sure they have synced completely.</p><p><a href=/images/devsecops/gitops-devel-cluster.png><img src=/images/devsecops/gitops-devel-cluster.png alt="GitOps Dashboard Devel"></a></p><h2 id=confirming-successful-deployment>Confirming successful deployment</h2><p>There are a number of steps you can do to check that the components have deployed:</p><ol><li><p>Pipelines should be available in the console on the left hand side.</p></li><li><p>Run a pipeline and check the build and if the image gets updated in the Quay registry on the Hub.</p></li><li><p>You should be able to select the route to the demo application in the test environment.</p></li><li><p>The development cluster name should show up in the ACS Central console.</p></li></ol><p><a href=/images/devsecops/acs-dashboard-2node.png><img src=/images/devsecops/acs-dashboard-2node.png alt=acs-central-with-devel></a></p><h2 id=next-up>Next up</h2><p>Deploy the the Multicluster DevSecOps <a href=/devsecops/production-cluster>secured production cluster</a></p></div></div></div><aside class="pf-l-grid__item pf-m-4-col pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#having-a-development-cluster-devel-join-the-hub>Having a development cluster (devel) join the hub</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#introduction>Introduction</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#allow-acm-to-deploy-the-devel-applications-to-a-subset-of-clusters>Allow ACM to deploy the devel applications to a subset of clusters</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploy-a-devel-cluster>Deploy a devel cluster</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#devel-setup-using-the-acm-ui>Devel setup using the ACM UI</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#devel-setup-using-cm-tool>Devel setup using <code>cm</code> tool</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#devel-setup-using-clusteradm-tool>Devel setup using <code>clusteradm</code> tool</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#devel-is-joined>Devel is joined</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#confirming-successful-deployment>Confirming successful deployment</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#next-up>Next up</a></li></ul></li></ul></nav></aside></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div></footer></main></div></body></html>